<html>
    <input type="file" id="fileInput" />
    <button onclick="upload()">Upload</button>
    <p id="progress"></p>
    
    <script>
        let socket = new WebSocket("ws://localhost:8080/upload-progress");
        let sessionId = "";

        socket.onopen = function () {
            console.log("WebSocket connected");
        };

        socket.onmessage = function (event) {
            const message = event.data;

            if (message.startsWith("SESSION_ID:")) {
                sessionId = message.replace("SESSION_ID:", "");
                console.log( sessionId);
            } else {
                document.getElementById("progress").innerText = event.data;

            }
        };

    
        function upload() {
            const file = document.getElementById("fileInput").files[0];
            const formData = new FormData();
            formData.append("file", file);
            formData.append("sessionId", sessionId);
            formData.append("metadata", new Blob([JSON.stringify({
                fileName: file.name,
                description: file.size.toString(),
                fileType: file.type
            })], { type: "application/json" }));

            fetch("http://localhost:8080/storage/add", {
                method: "POST",
                body: formData,
                headers: {
                    Authorization:"Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIrMjMzNTE3MTM2MjE1IiwiaWF0IjoxNzUyNDQ3MDMwLCJleHAiOjE3NTI5NjU0MzB9.NQXCmcXedAOwEokMy3A9Cl_OWfHR1CzsBjXxdjPY51A"
                }
            });
        }
    </script>

</html>